---
title: build-01-背景
created: '2019-09-30T07:37:10.438Z'
modified: '2020-01-13T14:28:48.651Z'
---

# build-01-背景

## 背景

在开启本项目之前，有幸用python完整实现过一个线上使用的工作流(workflow)/工作流系统，在对其进行持续迭代和维护后，有一些对工作流系统的思考。

### 价值

- 业务逻辑沉淀，可以理解为SOP(standard operating procedure)固化/平台化
  - 附带的就是缓解团队新人学习曲线的陡峭程度，当然业务知识还是需要学习的，只是这个过程被赋予了很长的缓冲期
- 持续迭代和运营即可保持高的流程成功率
  - 出问题的时候有明确的着手点，对薄弱环节进行加固即可维持逻辑的畅通，而不用眉毛胡子一把抓，从头梳理
- 有着断点续传的能力，可以让出错的流程从出错的地方继续往前走
  - 重试可重入的步骤，自动重试配置的次数或者人工触发重试
  - 跳过人工介入后实际已经成功的步骤

### 定位和局限性

- 工作流系统无状态，业务逻辑还是归业务
  - 工作流系统需要做到通用性，核心能力上不应该包含业务逻辑。
  - 业务逻辑才是最有价值的部分，业务知识该学的还是得学，逃不掉。

- 业务逻辑的迭代不能少
  - 一个优秀的工作流系统是一种顺滑剂，能做到尽量少的影响业务逻辑的迭代就已经不错了，架构设计上和业务逻辑迭代上还是不能怠惰，工作流系统不能越俎代庖。
  - 工作流系统的定位，最多可以类比为主机里的"数据总线"(都没到"主板"的程度)，核心的还是CPU和存储，数据总线主要是要做到足够标准，带宽足够大。

## 本次的初衷

虽然最近较长一段时间内也有维护和迭代复杂golang项目的经验，我个人还没有用golang新启动过项目，所以出于练手golang以及整理和分享的目的，考虑用golang重新实现一些我关于工作流系统最核心的能力的一些想法。类似于[Writing a sqlite clone from scratch in C](https://github.com/cstack/db_tutorial)，

### 有一些问题可以不用提出来:)

- 不要问为什么重复造轮子
- 不会太注意原创性，重要的是我理解了，项目里也有我完整的思考
  - 原python项目基本上是airflow的极简版，百分比的话，这部分代码估计最多有10%
  - 本golang项目的核心部分严重参考(https://square.github.io/spincycle/) ，实现了一期后，这部分代码的占比估计有40%，主要是spincycle在核心部分的设计和实现上还挺不错。当然往后会逐渐下降，因为后面几期会融入更多我的思考和计划中的能力。

### 本项目还有一些定位上的局限性

原项目的适用范围估计会局限在中小型团队或中小型项目，主要是，

- 没有引入DSL，只支持全部采用python来表达实现和编排workflow。
  - 这对于不同偏好的使用者来说无疑是一个局限，但也有好处就是，能够做很多定制化的事情，因为几乎能写任何代码。
  - 当然这个灵活性带来的安全方面的问题也无疑是另一个局限。

本项目不准备突破这个局限，因为不是本次的主要目标。

## 场景

本项目/原项目希望解决的问题，举个例子说明。

比如说完整搭建MySQL集群，不同公司的场景下，可能有几步到几十步不等，需要有一个工作流系统负责将人工SOP(标准作业程式standard operating procedure)固化下来。
- 比如可能有HTTP调用/shell执行/人工确认等不同类型的步骤，并且需要遵循步骤之间的依赖关系
- 另外也可能会与机器申请/ip申请/备份系统/容器/监控系统等多个组内外的系统打交道，参数的管理和校验甚至可以成为一个非常繁杂的事情

再复杂点，比如说对分库分表集群做单元化时，需要一次性同时搭建成百套相关联的MySQL集群，有这样一套系统的作用不言而喻。

总体来说，本项目和仅仅用于一些业务审批系统/工单系统的性质不太一样，与人的交互只是一小部分。但也不是无所不包，什么都干。

- 为了保持系统的状态相对不那么重，一些需要特殊环境/条件的任务肯定会分离出去执行。
- 一些繁重的工作比如编译kernel(只是举例)/拷贝备份这种执行很久的任务，也会分离出去执行，比如通过消息队列等方式剥离。


### 名词

- 原项目/原python项目/python项目 都是指原python项目
- 本项目/此项目/golang项目 都是指新的golang项目
